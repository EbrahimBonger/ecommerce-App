<!-- <table border="2">
    
    <tr>
        <th>Name</th>
        <th>Category</th>
        <th>Price</th>
        <th>Quantity</th>
  
      </tr>
    {% for products in session %}

    <tr>
      <td>{{product[1]}}</td>
      <td>
        {{product[2]}}
        
      </td>
      <td>{{product[3]}}</td>
      <td>
        <form name="f1" action="#" >
          <label for="edit1">{{product[4]}}</label>
          <input id="edit1" type="submit" name="edit" value="Edit">
         </form>
      </td>
      <td>{{product[4]}}</td>  
      
    </tr>
    {% endfor %}
    <button>
        <a type="button" href="checkout.html"> GO TO CHECKOUT!</a>
    </button>
   </table> -->


   <!-- {% if 'cart_item' in session %}
        <p><a id="btnEmpty" href="{{ url_for('.empty_cart') }}" class="btn btn-danger">Empty Cart</a></p>
                 <table class="table table-hover">
                     <thead>
                         <tr>
                             <th>Product</th>
                             <th>Quantity</th>
                             <th class="text-center">Unit Price</th>
                             <th class="text-center">Price</th>
                             <th> </th>
                         </tr>
                     </thead>
                     <tbody>
         {% for key, val in session['cart_item'].items() %}
          {% set quantity = session['cart_item'][key]['quantity'] %}
          {% set price = session['cart_item'][key]['price'] %}
          {% set item_price = session['cart_item'][key]['total_price'] %} 
                         <tr>
                             <td class="col-sm-8 col-md-6">
                             <div class="media">
                                 <!-- <a class="thumbnail pull-left" href="#"> <img class="media-object" src="/static/images/product-images/{{ session['cart_item'][key]['image'] }}" style="width: 72px; height: 72px;"> </a> -->
                                
                                 <!-- <form method="POST" action="/calculate">
                    <input type="hidden" name="title" value="{{session['cart_item'][key]['title']}}">
                    <input type="number" name="quantity" value="">
                    <input type="submit" value="Submit"> -->

                                 <div class="media-body">
                                  <h4 class="media-heading"> <a href="#">{{ session['cart_item'][key]['title'] }}</a></h4>
                                  <h5 class="media-heading"> by <a href="#">Brand name</a></h5>
                                  <span>Status: </span><span class="text-success"><strong>In Stock</strong></span>
                              </div>
                          </div></td>
                          <td class="col-sm-1 col-md-1" style="text-align: center">
                          <input type="email" class="form-control" value="{{ quantity }}">
                          </td>
                          <td class="col-sm-1 col-md-1 text-center"><strong>${{ price }} </strong></td>
                          <td class="col-sm-1 col-md-1 text-center"><strong>${{ item_price }} </strong></td>
                          <td class="col-sm-1 col-md-1">
                          <a href="{{ url_for('.delete_product', title=session['cart_item'][key]['title']) }}" class="btn btn-danger">
                              <span class="glyphicon glyphicon-remove"></span> Remove
                          </a></td>
                      </tr>
      {% endfor %}
                      <tr>
                          <td colspan="4"><h5>Total Quantity</h5></td>
                          <td class="text-right"><h5><strong>{{ session['all_total_quantity'] }}</strong></h5></td>
                      </tr>
                      <tr>
                          <td colspan="3"><h3>Total</h3></td>
                          <td colspan="2" class="text-right"><h3><strong>$ {{ session['all_total_price'] }}</strong></h3></td>
                      </tr>
                      <tr>
                          <td colspan="4">
                          <button type="button" class="btn btn-default">
                              <span class="glyphicon glyphicon-shopping-cart"></span> Continue Shopping
                          </button></td>
                          <td>
                          <button type="button" class="btn btn-success">
                              Checkout <span class="glyphicon glyphicon-play"></span>
                          </button></td>
                      </tr>
                  </tbody>
              </table>
    {% else: %}
    <div class="no-records">Your Cart is Empty</div>
    {% endif %}
          </div>
      </div>
  </div> -->



<!-- 
  from flask import Flask, session
import datetime
# from flask import render_template, request
from flask import Flask, render_template, request, redirect, url_for, flash
import mysql.connector
from mysql.connector import MySQLConnection, Error
# from python_mysql_dbconfig import read_db_config


#import sqlite3

app = Flask('app')
app.secret_key = b'mysecretkey'

mydb = mysql.connector.connect(
    host="ec2-100-26-20-223.compute-1.amazonaws.com",
    user="ebrahim5",
    password="seas",
    database="cs2541db"
)

@app.route('/')
def home():
  # Render the homepage 
  #return 'Hello World'
  return render_template("login.html")



#@app.route('/',methods=['GET', 'POST'])
@app.route('/login',methods=['GET', 'POST'])
def login():
  if request.method == 'POST':
    username = request.form.get("username")
    password = request.form.get("password")
    

    c = mydb.cursor(buffered=True)
    # p = mydb.cursor(buffered=True)

    # p.execute("SELECT * FROM product")
    # products = p.fetchall()

    c.execute('SELECT * FROM user WHERE username=%s AND passwordHash=%s', (username, password))

    

    users = c.fetchone()
    if users is None:
      c.close()
      return render_template('register.html', message='Please Sign Up first to Login!')
    # else:
    #     # tuple
    #   userId = order_c.fetchone()
    #   # Convert tuple to int
    #   userId = userId['userId']
    #   date = datetime.date.today()

      c.execute('INSERT INTO orders  (orderId, userId, date) VALUES (%s, %s, %s)', (1, userId, date))  

    mydb.commit()
    c.close()

    # the usesr grabs a cart upon first entry
    session.modified = True
    for key in list(session.keys()):
     session.pop(key)
    # print(session)
    if not 'cart_item' in session:
      
      session['total_price'] = 0
      session['cart_item'] = cart_item = {}
    
    session['username'] = username

    return redirect(url_for('products'))

@app.route('/logout')  
def logout():
  session.pop('username', None)
  flash("You have been logged out!")
  return redirect(url_for('.login'))

@app.route('/products/', methods=['GET', 'POST'])
def products():
#  try:
  # conn = mysql.connect()
  p = mydb.cursor(buffered=True)
  p.execute('SELECT * FROM product')
  
  rows = p.fetchall()
  # products = p.fetchall()
  mydb.commit()
  p.close() 
  # print(rows)
  dict = {}
  product_list = []
  # row[2] represents the category index in the tuple
  for row in rows:
    # row['running_qty'] = 0
    # print("running_qty")
    # print(row)
    if row[2] in dict:
        dict.get(row[2]).append(row)
        product_list.append(row[1])
    else:
        dict[row[2]] = [row]
        product_list.append(row[1])
    
  
  # TO DO: store as a dict to keep track of the quantity
  
  session['product_list'] = product_list
  return render_template('products.html', dict=dict)

@app.route('/add', methods=['GET', 'POST'])
def add_product_to_cart():
  session.modified = True
  c = None 
  order_c = None
  
  _quantity = int(request.form['quantity'])
  _title = request.form['title'] # it gives the name user clicked
  title = request.form['title']
  
  print("title")
  if not title in session['product_list']:
    print("please enter valid entry!")
    error = "Please, enter a valid entry!"
    message = "please enter valid entry!"
    return render_template('alert.html', error=error)

  # print(session['product_list'])
  # for data in session['product_list']:
  #   print(data[1])
    
  if _quantity <= 0 or None:
    return
  if _title and _quantity and request.method == 'POST':

    # check for the stock avaliability
    c = mydb.cursor(buffered=True, dictionary=True)
    order_c = mydb.cursor(buffered=True, dictionary=True)

     
  
    username = session['username']    
    order_c.execute('SELECT userId FROM user WHERE username =%s', (username,))

    # tuple
    userId = order_c.fetchone()
    # Convert tuple to int
    userId = userId['userId']
    
    given = _title
    checkQuery = ("SELECT * FROM product WHERE title=%s")
    userAuthInfo = (given,)
    c.execute(checkQuery, userAuthInfo)

    row = c.fetchone()

        # check if the product already added to the cart and the user has modifiyed the quantity
    if _title in session['cart_item']:
      print("The item does exist " + _title)

      # add the old running back to the stock
      old_running_qty = session['cart_item'][title]['running_qty']
      old_stock_qty = session['cart_item'][title]['quantity']
      session['cart_item'][title]['quantity'] = old_running_qty + old_stock_qty
      #replace it by the new running quantity
      session['cart_item'][title]['running_qty'] = _quantity

      item_price = session['cart_item'][title]['price']
      new_total_price = _quantity * item_price
      session['total_price'] = new_total_price
      stock_quantity = session['cart_item'][title]['quantity'] - _quantity
      session['cart_item'][title]['quantity'] = stock_quantity
      

      #upate the database with user changes
      productId = session['cart_item'][title]['productId']
      running_qty = session['cart_item'][title]['running_qty']
      price = session['cart_item'][title]['price']
      date = datetime.date.today()
      # order_c.execute('UPDATE orders SET quantity=%s, date=%s WHERE userId=%s AND productId=%s', (running_qty, date, userId, productId))
      # update_product(productId, running_qty)


    else:
      print("The item does NOT exist " + _title)
      session['cart_item'][row['title']] = row
      for key, val in session['cart_item'].items():
        if key == _title:
          
          session['cart_item'][key]['running_qty'] = _quantity

          stock_quantity = session['cart_item'][key]['quantity'] - _quantity
          session['cart_item'][key]['quantity'] = stock_quantity
          current_products_price = session['cart_item'][key]['price'] * _quantity
          old_price = session['total_price'] 
          current_products_price = old_price + current_products_price
          session['total_price'] = current_products_price 
      

          # Inserting to the database
          productId = session['cart_item'][title]['productId']
          running_qty = session['cart_item'][title]['running_qty']
          price = session['cart_item'][title]['price']


          # date = datetime.date.today()
          # order_c.execute('INSERT INTO orders  (orderId, userId, date) VALUES (%s, %s, %s)', (1, userId, date))


    # Order table schema
    # CREATE TABLE `orders` (
    # `orderId` BIGINT NOT NULL AUTO_INCREMENT,
    # `userId` BIGINT NULL DEFAULT NULL,
    # `productId` BIGINT NOT NULL,
    # `quantity` SMALLINT(6) NOT NULL DEFAULT 0,
    # `price` FLOAT NOT NULL DEFAULT 0,
    # `date` DATE,
    # PRIMARY KEY (`orderId`, `productId`)
    # );

     

  if not session['cart_item']:
    print("The cart is empty")
    
    
    
    mydb.commit()


  return redirect(url_for('products'))

@app.route('/test', methods=['GET', 'POST'])
def test():
  return "Test Page"
#/<string:message>
@app.route('/alert', methods=['GET', 'POST'])
def alert(message):
  return render_template('alert.html', message)  

@app.route('/calculate', methods=['GET', 'POST'])
def calculate_on_checkout():
  # c  = mydb.cursor()
  _quantity = int(request.form['quantity'])
  _title = request.form['title']
  print("_title and quantity")
  print(_title)
  print(_quantity)
  
  if _quantity and _title and request.method == 'POST':
    
    
    all_total_price = 0
    all_total_quantity = 0

    session.modified = True
    if 'cart_item' in session:
    #  if the product already exist, add the quantity and price of the existing
      if row['title'] in session['cart_item']:
        for key, value in session['cart_item'].items():
          old_quantity = session['cart_item'][key]['quantity']
          total_quantity = old_quantity + _quantity
          session['cart_item'][key]['quantity'] = total_quantity
          session['cart_item'][key]['total_price'] = total_quantity * row['price']
    
    for key, value in session['cart_item'].items():

     individual_quantity = session['cart_item'][key]['quantity']
     individual_price = session['cart_item'][key]['price']

     all_total_quantity = all_total_quantity + individual_quantity
     all_total_price = all_total_price + individual_price
  else:
    # session['cart_item'] = itemArray
    all_total_quantity = all_total_quantity + _quantity
    all_total_price = all_total_price + _quantity * row['price']
    
  session['all_total_quantity'] = all_total_quantity
  session['all_total_price'] = all_total_price

  return redirect(url_for('checkout'))

@app.route('/delete_product/<string:title>')
def delete_product_from_product(title):
 try:
  all_total_price = 0
  all_total_quantity = 0
  session.modified = True
   
  for key, val in session['cart_item'].items():

     if title == key:    
      # adjust the total price
      removed_price = session['cart_item'][key]['running_qty'] * session['cart_item'][key]['price']
      old_price = session['total_price']
      session['total_price'] = old_price - removed_price
      session['cart_item'].pop(key)
      break
   
  return redirect(url_for('.products'))
 except Exception as e:
  print(e)


@app.route('/delete_checkout/<string:title>')
def delete_product_from_checkout(title):
 try:
  all_total_price = 0
  all_total_quantity = 0
  session.modified = True
   
  for key, val in session['cart_item'].items():

     if title == key:    
      # adjust the total price
      removed_price = session['cart_item'][key]['running_qty'] * session['cart_item'][key]['price']
      old_price = session['total_price']
      session['total_price'] = old_price - removed_price
      session['cart_item'].pop(key)
      break
   
  return redirect(url_for('.checkout'))
 except Exception as e:
  print(e)



@app.route('/checkout', methods=['GET', 'POST'])
def checkout():

  return render_template('checkout.html')
@app.route('/empty', methods=['GET', 'POST'])
def empty_cart():
 try:
  session.modified = True
  order_c = None
  print(session['cart_item'])
  session['cart_item'] = {}
  session['total_price'] = 0
  print(session['cart_item'])

  # DELETE FROM products WHERE product_id=1;

  # order_c = mydb.cursor(buffered=True, dictionary=True)
  # username = session['username']    
  # order_c.execute('SELECT userId FROM user WHERE username =%s'(username,))

  # # tuple
  # userId = order_c.fetchone()
  # # Convert tuple to int
  # userId = userId['userId']
  # order_c.execute('DELETE FROM orders WHERE userId =%s', (userId,))
  
  return redirect(url_for('.checkout'))
 except Exception as e:
  print(e)





@app.route('/register', methods=['GET', 'POST'])
def register():

  if request.method == 'POST':
    fname = request.form.get("fname")
    lname = request.form.get("lname")
    email = request.form.get("email")
    username = request.form.get("user")
    password = request.form.get("pass")


    c = mydb.cursor()

    c.execute('INSERT INTO user (username, first_name, last_name, email, passwordHash)  VALUES (%s, %s, %s, %s, %s)', (username, fname, lname, email, password))
    

    mydb.commit()
    c.close()
    
    return render_template('registered.html')

  ## Otherwise return register page on get request
  return render_template('register.html')

@app.route('/user',methods=['GET'])
def user():
  return render_template('loggedin.html',message="Hello %s" % (session['username']))

def array_merge( first_array , second_array ):
 if isinstance( first_array , list ) and isinstance( second_array , list ):
  return first_array + second_array
 elif isinstance( first_array , dict ) and isinstance( second_array , dict ):
  return dict( list( first_array.items() ) + list( second_array.items() ) )
 elif isinstance( first_array , set ) and isinstance( second_array , set ):
  return first_array.union( second_array )
 return False  

def close(self):
    self.cursor.close()
    self.connection.close()

def execute(self, sql):
    return self.cursor.execute(sql)

def fetchall(self):
    return self.cursor.fetchall()

def commit(self):
    #self.cursor.close()
    self.connection.commit() 


def update_product(productId, quantity):
    # read database configuration
    db_config = read_db_config()

    # prepare query and data
    query = """ UPDATE orders
                SET quantity = %s
                WHERE productId = %s """

    data = (title, book_id)

    try:
        conn = MySQLConnection(**db_config)

        # update product quantity
        cursor = conn.cursor()
        cursor.execute(query, data)

        # accept the changes
        conn.commit()

    except Error as error:
        print(error)

    finally:
        cursor.close()
        conn.close()


app.run(host='0.0.0.0', port=8080) -->

<!-- 
@app.route('/calculate', methods=['GET', 'POST'])
def calculate_on_checkout():
  # c  = mydb.cursor()
  _quantity = int(request.form['quantity'])
  _title = request.form['title']
  print("_title and quantity")
  print(_title)
  print(_quantity)
  
  if _quantity and _title and request.method == 'POST':
    
    
    all_total_price = 0
    all_total_quantity = 0

    session.modified = True
    if 'cart_item' in session:
    #  if the product already exist, add the quantity and price of the existing
      if row['title'] in session['cart_item']:
        for key, value in session['cart_item'].items():
          old_quantity = session['cart_item'][key]['quantity']
          total_quantity = old_quantity + _quantity
          session['cart_item'][key]['quantity'] = total_quantity
          session['cart_item'][key]['total_price'] = total_quantity * row['price']
    
    for key, value in session['cart_item'].items():

     individual_quantity = session['cart_item'][key]['quantity']
     individual_price = session['cart_item'][key]['price']

     all_total_quantity = all_total_quantity + individual_quantity
     all_total_price = all_total_price + individual_price
  else:
    # session['cart_item'] = itemArray
    all_total_quantity = all_total_quantity + _quantity
    all_total_price = all_total_price + _quantity * row['price']
    
  session['all_total_quantity'] = all_total_quantity
  session['all_total_price'] = all_total_price

  return redirect(url_for('checkout')) -->


  
<!-- # def array_merge( first_array , second_array ):
#  if isinstance( first_array , list ) and isinstance( second_array , list ):
#   return first_array + second_array
#  elif isinstance( first_array , dict ) and isinstance( second_array , dict ):
#   return dict( list( first_array.items() ) + list( second_array.items() ) )
#  elif isinstance( first_array , set ) and isinstance( second_array , set ):
#   return first_array.union( second_array )
#  return False   -->